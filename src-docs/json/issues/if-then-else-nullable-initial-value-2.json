{
  "title": "Wildlife Survey",
  "type": "object",
  "x-options": {
    "format": "grid",
    "grid": {
      "columns": 12
    }
  },
  "required": [
    "species"
  ],
  "properties": {
    "species": {
      "title": "Wildlife Species",
      "$ref": "#/$defs/global/occurrence_count_statistics_nullable",
      "properties": {
        "presence": {
          "title": "Was this species present in your area during **2024/25 season**?"
        },
        "count": {
          "title": "Number of breeding pairs in **Spring 2025**"
        },
        "statistics": {
          "title": "Population statistics for **2024/25 season**",
          "properties": {
            "total": {
              "title": "Total population count 2024/25"
            }
          }
        }
      }
    }
  },
  "$defs": {
    "global": {
      "unclassified_modal": {
        "x-info": {
          "variant": "modal",
          "title": "### Unclassified Data",
          "content": "If the breakdown of population data is not known, please enter the total count under 'unclassified'."
        }
      },
      "occurrence": {
        "type": "object",
        "required": [
          "presence"
        ],
        "properties": {
          "presence": {
            "title": "Was this species present during the current season?",
            "type": "string",
            "enum": [
              "yes",
              "no",
              "unknown",
              "no_data"
            ],
            "x-options": {
              "enumTitles": [
                "yes",
                "no",
                "unknown",
                "no data"
              ],
              "enforceEnumDefault": false,
              "format": "radios-inline"
            }
          }
        }
      },
      "occurrence_count_statistics_nullable": {
        "$ref": "#/$defs/global/occurrence",
        "properties": {
          "count": {
            "title": "Number of breeding pairs",
            "x-options": {
              "enforceConst": true
            }
          },
          "statistics": {
            "title": "Population statistics current season",
            "type": "object",
            "x-options": {
              "format": "grid"
            },
            "properties": {
              "adults": {
                "title": "Adults (count)",
                "x-options": {
                  "enforceConst": true,
                  "grid": {
                    "columns": 3
                  }
                }
              },
              "juveniles": {
                "title": "Juveniles (count)",
                "x-options": {
                  "enforceConst": true,
                  "grid": {
                    "columns": 3
                  }
                }
              },
              "migrants": {
                "title": "Migrants (count)",
                "x-options": {
                  "enforceConst": true,
                  "grid": {
                    "columns": 3
                  }
                }
              },
              "observed": {
                "title": "Other observed (count)",
                "x-options": {
                  "enforceConst": true,
                  "grid": {
                    "columns": 3
                  }
                }
              },
              "unclassified": {
                "$ref": "#/$defs/global/unclassified_modal",
                "title": "Unclassified (count)",
                "x-options": {
                  "enforceConst": true,
                  "grid": {
                    "columns": 3
                  }
                }
              },
              "total": {
                "title": "Total population current season",
                "enforceConst": true,
                "readOnly": true
              }
            }
          }
        },
        "if": {
          "properties": {
            "presence": {
              "const": "yes"
            }
          }
        },
        "then": {
          "properties": {
            "count": {
              "x-format": "number-nullable",
              "type": [
                "null",
                "integer"
              ],
              "maximum": 9999,
              "minimum": 0
            },
            "statistics": {
              "$filters": {
                "$func": "checkSum",
                "$vars": {
                  "source": [
                    "adults",
                    "juveniles",
                    "migrants",
                    "observed",
                    "unclassified"
                  ],
                  "destination": "total"
                }
              },
              "properties": {
                "adults": {
                  "x-format": "number-nullable",
                  "type": [
                    "null",
                    "integer"
                  ],
                  "maximum": 9999,
                  "minimum": 0
                },
                "juveniles": {
                  "x-format": "number-nullable",
                  "type": [
                    "null",
                    "integer"
                  ],
                  "maximum": 9999,
                  "minimum": 0
                },
                "migrants": {
                  "x-format": "number-nullable",
                  "type": [
                    "null",
                    "integer"
                  ],
                  "maximum": 9999,
                  "minimum": 0
                },
                "observed": {
                  "x-format": "number-nullable",
                  "type": [
                    "null",
                    "integer"
                  ],
                  "maximum": 9999,
                  "minimum": 0
                },
                "unclassified": {
                  "$ref": "#/$defs/global/unclassified_modal",
                  "x-format": "number-nullable",
                  "type": [
                    "null",
                    "integer"
                  ],
                  "maximum": 9999,
                  "minimum": 0
                },
                "total": {
                  "type": "integer"
                }
              }
            }
          }
        },
        "else": {
          "if": {
            "properties": {
              "presence": {
                "const": "no"
              }
            }
          },
          "then": {
            "properties": {
              "count": {
                "type": "integer",
                "const": 0,
                "readOnly": true
              },
              "statistics": {
                "readOnly": true,
                "properties": {
                  "adults": {
                    "type": "integer",
                    "const": 0
                  },
                  "juveniles": {
                    "type": "integer",
                    "const": 0
                  },
                  "migrants": {
                    "type": "integer",
                    "const": 0
                  },
                  "observed": {
                    "type": "integer",
                    "const": 0
                  },
                  "unclassified": {
                    "$ref": "#/$defs/global/unclassified_modal",
                    "type": "integer",
                    "const": 0
                  },
                  "total": {
                    "type": "integer",
                    "readOnly": true,
                    "default": 0,
                    "const": 0
                  }
                }
              }
            }
          },
          "else": {
            "if": {
              "properties": {
                "presence": {
                  "const": "unknown"
                }
              }
            },
            "then": {
              "properties": {
                "count": {
                  "type": "string",
                  "default": "",
                  "const": "",
                  "readOnly": true,
                  "description": "unknown"
                },
                "statistics": {
                  "readOnly": true,
                  "properties": {
                    "adults": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "unknown"
                    },
                    "juveniles": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "unknown"
                    },
                    "migrants": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "unknown"
                    },
                    "observed": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "unknown"
                    },
                    "unclassified": {
                      "$ref": "#/$defs/global/unclassified_modal",
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "unknown"
                    },
                    "total": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "unknown"
                    }
                  }
                }
              }
            },
            "else": {
              "properties": {
                "count": {
                  "type": "string",
                  "default": "",
                  "const": "",
                  "readOnly": true,
                  "description": "no data"
                },
                "statistics": {
                  "readOnly": true,
                  "properties": {
                    "adults": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "no data"
                    },
                    "juveniles": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "no data"
                    },
                    "migrants": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "no data"
                    },
                    "observed": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "no data"
                    },
                    "unclassified": {
                      "$ref": "#/$defs/global/unclassified_modal",
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "no data"
                    },
                    "total": {
                      "type": "string",
                      "default": "",
                      "const": "",
                      "readOnly": true,
                      "description": "no data"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}